/**
 * @license
 *
 * GoTo
 * scrolls to an anchor element
 * @author idomusha / https://github.com/idomusha
 */
!function(e,n){var o,t={defaults:{sContainer:"#js-wrapper",sLinks:".js-goto",sLinkPrev:".js-goto-prev",sLinkNext:".js-goto-next",sFixedLinks:".js-fixed",scrolled:!1,debug:!1,iAnchorPrefixCharacters:0,gap:0,$scrollContainer:n(),$links:n(),sAnchor:null,sLastAnchor:null,$elements:n(),$clickedElement:n(),$anchorElement:n(),iCurrentScrollPosition:0,iScrollSpeed:1e3,sDirection:"vertical",bColumn:!1,bInitial:!1},options:{},settings:{},init:function(){this.settings=n.extend({},this.defaults,this.options),o=this.settings,o.debug&&console.log("##################### init()"),o.$links=this.define(o.sLinks),o.$linkPrev=this.define(o.sLinkPrev),o.$linkNext=this.define(o.sLinkNext),o.$links=this.define(o.sLinks),o.$fixedLinks=this.define(o.sFixedLinks),o.$fixedLinks.addClass("invisible"),o.$elements=o.$links.map(function(){var e=n(n(this).attr("href"));return e.length?e:void 0}),"vertical"==o.sDirection?o.$scrollContainer=n("html,body"):"horizontal"==o.sDirection&&(o.$scrollContainer=this.define(o.sContainer)),n(".js-last-column").length&&(o.bColumn=!0),o.bColumn&&this.width(),this.onUIActions(),this.onLoad()},width:function(){o.debug&&console.log("##################### width()");try{var e=n(".js-last-column"),t=e.position(),i=e.width(),l=t.left+i;e.parents("section").eq(0).css("width",l)}catch(s){o.debug&&console.log("!!!",s)}},define:function(e){var o=n();if("undefined"!=typeof e)return"object"==typeof e&&null!==e?o=e:"string"==typeof e&&(o=n(e)),o},onUIActions:function(){o.debug&&console.log("##################### onUIActions()"),n(document).on("click",o.sLinks,function(e){return o.debug&&console.log(">>>>>>>>>>>>>>>>>>>>>> $links: click()"),o.debug&&console.log(e),e.preventDefault(),0==n(e.target).closest(o.$links).length?!1:(o.$clickedElement=t.find(e),o.sAnchorLink=t.get(o.$clickedElement),void t.set(o.sAnchorLink))}),n(document).on("click",o.sLinkPrev,function(e){return o.debug&&console.log(">>>>>>>>>>>>>>>>>>>>>> $linkPrev: click()"),o.debug&&console.log(e),e.preventDefault(),0==n(e.target).closest(o.$linkPrev).length?!1:(o.$clickedElement=t.find(e),o.sAnchorLink=t.get("prev"),void t.set(o.sAnchorLink))}),n(document).on("click",o.sLinkNext,function(e){return o.debug&&console.log(">>>>>>>>>>>>>>>>>>>>>> $linkNext: click()"),o.debug&&console.log(e),e.preventDefault(),0==n(e.target).closest(o.$linkNext).length?!1:(o.$clickedElement=t.find(e),o.sAnchorLink=t.get("next"),void t.set(o.sAnchorLink))});var i=null;o.$scrollContainer.on("scroll touchmove",function(e){o.debug&&console.log(">>>>>>>>>>>>>>>>>>>>>> s.$scrollContainer: scroll()/touchmove()"),null!==i&&clearTimeout(i),i=setTimeout(function(){t.onScrollEnd(e,n("#js-wrapper").scrollLeft()),i=null},150)}),n(e).on("resize",function(){o.iCurrentScrollPosition=t.position(),o.bColumn&&t.width()})},onLoad:function(){o.debug&&console.log("##################### onLoad()"),e.location.hash.length&&setTimeout(function(){e.scrollTo(0,0),o.$scrollContainer.css({display:"table"}),o.$scrollContainer.get(0).offsetHeight,o.$scrollContainer.css({display:""}),o.sAnchorLink=t.get(e.location.hash),setTimeout(function(){t.set(o.sAnchorLink)},1500)},1),n(".goto-pager").length&&o.$elements[0].parent().width()<n(e).width()&&(n(".goto-pager").hide(),n(".goto-pager").nextAll(".js-goto-nav").hide())},onScrollEnd:function(i,l){o.debug&&console.log("##################### onScrollEnd()"),o.iCurrentScrollPosition=t.position();var s=o.iCurrentScrollPosition+("vertical"==o.sDirection)?n(e).height():n(e).width(),r=0,c=o.$elements.map(function(){return"vertical"==o.sDirection?r=n(this).offset().top:"horizontal"==o.sDirection&&(r=n(this).offset().left),s>r?this:void 0});c=c[c.length-1];var d=c&&c.length?c[0].id:"",a=n("#"+d),g=parseInt(a.index(),10),h=o.$elements.length,u="";return void 0!==l&&(l<=n(e).width()-n(e).width()/20?o.$fixedLinks.addClass("invisible"):o.$fixedLinks.removeClass("invisible")),void 0!=o.$elements[0]&&l==o.$elements[0].parent().width()+parseInt(o.$elements[0].parent().css("margin-left"),10)&&o.debug&&console.log("end!"),void 0==c?!1:void(o.sLastAnchor!==d&&(o.debug&&console.log("sElementId",d),o.debug&&console.log("iElementIndex",g),o.debug&&console.log("iElements: ",h),o.sLastAnchor=d,o.$links.removeClass("active").removeAttr("style").filter("[href=#"+d+"]").addClass("active"),0==g?(o.$linkPrev.hide(),u=a.next().children(".title").children("span").text(),o.$linkNext.children("span").text(u),o.$linkNext.show(u)):g==h-1?(u=a.prev().children(".title").children("span").text(),o.$linkPrev.children("span").text(u),o.$linkPrev.show(u),o.$linkNext.hide()):-1!=g&&(u=a.prev().children(".title").children("span").text(),o.$linkPrev.children("span").text(u),o.$linkPrev.show(),u=a.next().children(".title").children("span").text(),o.$linkNext.children("span").text(u),o.$linkNext.show(u))))},position:function(){o.debug&&console.log("##################### position()");try{return"vertical"==o.sDirection?o.$scrollContainer.scrollTop():o.$scrollContainer.scrollLeft()}catch(e){o.debug&&console.log("!!!",e)}},find:function(e){o.debug&&console.log("##################### find()");try{var t=null;return t=n(e.target).closest(o.$links),o.debug&&console.log(t),t}catch(i){o.debug&&console.log("!!!",i)}},get:function(e){o.debug&&console.log("##################### get()");try{var t=null;return"object"==typeof e&&null!==e?(e.hasAttr("href")&&(t="_initial"==e.attr("href")?e.attr("href"):"#"+e.attr("href").substring(1+o.iAnchorPrefixCharacters)),o.sAnchor=t):"string"==typeof e&&("#"==e.charAt(0)||"_"==e.charAt(0)?t=e:"prev"==e?n("#"+o.sLastAnchor).prev().length&&(t="#"+n("#"+o.sLastAnchor).prev().attr("id").substring(3)):"next"==e&&n("#"+o.sLastAnchor).next().length&&(t="#"+n("#"+o.sLastAnchor).next().attr("id").substring(3))),o.debug&&console.log("_$anchorElement",t),t}catch(i){o.debug&&console.log("!!!",i)}},set:function(e){o.debug&&console.log("##################### set()");try{return 0==n('*[id="'+e.substring(1)+'"]').length&&"_initial"!=e?(o.debug&&console.log("Anchor link doesn't to an existing DOM element."),o.debug&&console.log("Anchor link: "+e),!1):(t.move(o.bInitial?"_initial":e),!1)}catch(i){o.debug&&console.log("!!!",i)}},move:function(e,i,l){o.debug&&console.log("##################### move("+e+", "+i+", "+l+")");var s=(n(),0),r={},c=void 0!==l&&"integer"==typeof l?l:0;if("_initial"!=e){var d=n(e);o.debug&&console.log("sDirection: "+o.sDirection),"vertical"==o.sDirection?s=d.offset().top:"horizontal"==o.sDirection&&(s=o.$scrollContainer.scrollLeft()+d.offset().left),o.debug&&console.log("_scrollContainer.scrollLeft(): ",o.$scrollContainer.scrollLeft()),o.debug&&console.log("_$anchor: ",d),o.debug&&console.log("_iTargetOffset: "+s)}"vertical"==o.sDirection?r={scrollTop:s-c-o.gap}:"horizontal"==o.sDirection&&(r={scrollLeft:s-c-o.gap}),o.iScrollSpeed=Math.abs(o.iCurrentScrollPosition-s),o.iScrollSpeed>1e3&&(o.iScrollSpeed=1e3),o.iScrollSpeed<250&&(o.iScrollSpeed=250),o.$scrollContainer.animate(r,o.iScrollSpeed,function(){o.bScrolled?o.bScrolled=!1:(o.bScrolled=!0,t.process(),t.onScrollEnd(void 0,s-c-o.gap),n.isFunction(i)&&t.after(i),setTimeout(function(){o.bScrolled=!1},100))})},process:function(){o.debug&&console.log("##################### process()"),null!=o.sAnchorLink&&(e.location.hash=o.sAnchorLink),o.$clickedElement=null,o.sAnchorLink=null},after:function(e){o.debug&&(console.log("##################### after()"),e())}};e.GoTo=t}(window,jQuery);